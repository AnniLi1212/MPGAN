# MPGAN

All the code used for Kansal et. al. *Particle Cloud Generation with Message Passing Generative Adversarial Networks* [`arXiv:2106.11535`](https://arxiv.org/abs/2106.11535).

## Overview

This repository provides PyTorch code for the message passing GAN (MPGAN) [model](mpgan/model.py) and the four [evaluation metrics](mpgan/evaluation.py) introduced in the paper. Along with this we provide code for [training](train.py) the models from scratch, and for [generating](gen_samples.py) and [plotting](save_outputs.py) the particle clouds, as well as our PyTorch implementations of existing models ([ParticleNet](mpgan/particlenet.py), [point cloud GANs](mpgan/ext_models.py)). Finally, we include [weights of the fully trained models](final_models) discussed in the paper. 

## Dependencies

All necessary libraries (and a couple more) are listed in the [Dockerfile](Dockerfile). You are welcome to use the corresponding image uploaded [here](gitlab-registry.nautilus.optiputer.net/raghsthebest/mnist-graph-gan:latest). 

## Dataset

We introduce the JetNet particle cloud dataset, uploaded [here](https://zenodo.org/record/4834876#.YOIyni1w1hE) in `csv` format. Notebooks with visualizations of particle clouds and particle/jet features are coming soon. 


## Training

Instructions for training MPGAN from scratch:

1. Install libraries listed in the [Dockerfile](Dockerfile).
2. Download the [JetNet](https://zenodo.org/record/4834876#.YOIyni1w1hE) dataset, convert from `csv` to PyTorch format - reshaped as `[N, 30, 4]` shape tensors, and save them in the [datasets](datasets) directory. e.g. for gluon jets:

`torch.save(torch.tensor(np.loadtxt('g_jets.csv').reshape(-1, 30, 4)), 'datasets/g_jets.pt')`

3. Start training with `python train.py --name test_model --jets g [args]`. By default, model params will be saved every five epochs in the models directory, figures of particle and jet features in the figs dir, plots of the training losses and all the evaluation metrics over time in the losses dir, and logs and training args in the out and args directories respectively. (All dirs will be created automatically.)

Some notes:
 - Will run on GPUs by default if available. 
 - The default architecture args correspond to the final model architecture used for the paper. 
 - Full list of possible arguments are in [mpgan/setup.py](mpgan/setup.py).


## Generation

Pre-trained models can be used for data generation using the [gen_samples.py](gen_samples.py) script. By default it generates samples for all the models listed in the [final_models](final_models) directory and saves them in numpy format as `final_models/[model name]/samples.npy`. Samples for your own pre-trained models can be generated by adding the training args and model weights in the `final_models` directory with the same format and running `gen_samples.py`.
